function tue-save-map {
    if [ -z "$1" ]; then
        echo "Usage: tue-save-map MAP_NAME

The map will be stored in the package amigo_maps, in folder map/MAP_NAME/loc, map/MAP_NAME/nav and map/MAP_NAME/raw."
        return
    fi

    rm -f /tmp/temp_map.pgm
    rm -f /tmp/temp_map.yaml

    # store the map in /tmp
    rosrun map_server map_saver -f /tmp/temp_map map:=/nav_map

    # create the map directory structure (nav, loc, raw) in tue_maps/maps
    MAP_DIR=`rospack find tue_maps`/maps
    mkdir -p $MAP_DIR/$1/loc
    mkdir -p $MAP_DIR/$1/nav
    mkdir -p $MAP_DIR/$1/raw

    # change reference to the image file in the yaml file to 'pgm'
    sed -i "s/\/tmp\/temp_map.pgm/pgm/g" /tmp/temp_map.yaml

    # move the yaml and pgm to the raw folder
    mv /tmp/temp_map.yaml $MAP_DIR/$1/raw/yaml
    mv /tmp/temp_map.pgm $MAP_DIR/$1/raw/pgm

    # copy the yaml and pgm files to the loc folder
    cp $MAP_DIR/$1/raw/yaml $MAP_DIR/$1/loc/yaml
    cp $MAP_DIR/$1/raw/pgm $MAP_DIR/$1/loc/pgm

    # copy the yaml and pgm files to the nav folder
    cp $MAP_DIR/$1/raw/yaml $MAP_DIR/$1/nav/yaml
    cp $MAP_DIR/$1/raw/pgm $MAP_DIR/$1/nav/pgm
}
